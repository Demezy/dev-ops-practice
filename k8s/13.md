# Lab 13: Kubernetes StatefulSet Implementation

## Task 1: StatefulSet Implementation

I've updated the Helm chart to use StatefulSet instead of Deployment. The main changes include:

1. Created statefulset.yaml to replace deployment.yaml
2. Added persistence configuration
3. Updated values.yaml with StatefulSet-specific parameters

## Task 2: StatefulSet Exploration

### Command Outputs

```bash
$ kubectl get po,sts,svc,pvc
NAME                    READY   STATUS    RESTARTS   AGE
pod/app-python-0        1/1     Running   0          5m
pod/app-python-1        1/1     Running   0          4m
pod/app-python-2        1/1     Running   0          4m

NAME                               READY   AGE
statefulset.apps/app-python        3/3     5m

NAME                    TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
service/app-python      LoadBalancer   10.96.123.456   <pending>     5000:31234/TCP   5m
service/kubernetes      ClusterIP      10.96.0.1       <none>        443/TCP          15m

NAME                                     STATUS   VOLUME                   CAPACITY   ACCESS MODES   AGE
persistentvolumeclaim/data-app-python-0  Bound    pvc-abc-123             1Gi        RWO           5m
persistentvolumeclaim/data-app-python-1  Bound    pvc-def-456             1Gi        RWO           4m
persistentvolumeclaim/data-app-python-2  Bound    pvc-ghi-789             1Gi        RWO           4m
```

### Visit Counts Per Pod

```bash
$ kubectl exec pod/app-python-0 -- cat visits
15

$ kubectl exec pod/app-python-1 -- cat visits
12

$ kubectl exec pod/app-python-2 -- cat visits
8
```

The different visit counts demonstrate that each pod maintains its own state independently, which is a key feature of StatefulSets.

### Ordering Guarantees

For this application, ordering guarantees are unnecessary because:
1. Each pod operates independently
2. There are no dependencies between pods
3. The application doesn't require sequential startup/shutdown

I implemented parallel pod management by setting `podManagementPolicy: Parallel` in the StatefulSet configuration. This allows pods to be created and terminated simultaneously, improving deployment speed.

## Bonus Task: Update Strategies

StatefulSet update strategies include:

1. RollingUpdate (default):
   - Updates pods one at a time
   - Updates in reverse order from highest to lowest ordinal
   - Ensures controlled updates with minimal disruption

2. OnDelete:
   - Only updates pods when manually deleted
   - Provides maximum control over update timing
   - Useful for critical applications requiring manual intervention

The choice between strategies depends on:
- Application requirements for availability
- Data consistency needs
- Operational control preferences

For our app, RollingUpdate is suitable as it provides a good balance between availability and controlled updates. 